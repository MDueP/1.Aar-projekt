Connect-AzAccount

$resourcegroup = ''
$location = 'ukwest'
$Subnet1 = New-AzVirtualNetworkSubnetConfig -Name Subnet1 -AddressPrefix "10.0.0.0/24"
$Subnet2  = New-AzVirtualNetworkSubnetConfig -Name Subnet2  -AddressPrefix "10.0.1.0/24"
$vnet_name = 'Vnet1'
$vnet = New-AzVirtualNetwork -Name @vnet_name -ResourceGroupName $resourcegroup -Location $location -AddressPrefix "10.0.0.0/16" -Subnet $Subnet1,$Subnet2
$cred = Get-Credential
$vmParams = @{
    ResourceGroupName = $resourcegroup
    Name = ''
    Location = $location
    ImageName = 'Ubuntu2204'
    VirtualNetworkName = $vnet_name
    SubnetName = 'Subnet1'
    PublicIpAddressName = 'publicip'
    Credential = $cred
    OpenPorts = 3389, 80, 22, 5000
    Size = 'Standard_D2s_v3'
  }
  $accountname = 'blobaccountkeahold2a'

New-AzResourceGroup -Name $resourcegroup -Location $location

$vnet
New-AzVm @vmParams

New-AzStorageAccount -ResourceGroupName $resourcegroup `
  -Name $accountname `
  -Location $location `
  -SkuName Standard_RAGRS `
  -Kind StorageV2 `
  -AllowBlobPublicAccess $true

$ctx = New-AzStorageContext -StorageAccountName blobwebsite -UseConnectedAccount
New-AzStorageContainer -Name "websitecontainerhold2a" -Context $ctx

$publicIp = Get-AzPublicIpAddress -Name 'publicip' -ResourceGroupName $resourcegroup

$publicIp |
  Select-Object -Property Name, IpAddress, @{label='FQDN';expression={$_.DnsSettings.Fqdn}}
